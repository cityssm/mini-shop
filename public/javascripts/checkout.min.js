"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(a,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e={};const t=document.getElementById("card--cart"),r=document.getElementById("container--cartTotal"),o=document.getElementById("form--shipping");let a={itemTotal:0,feeTotals:{}},n=[];const s=t=>{t.preventDefault();const r=parseInt(t.currentTarget.getAttribute("data-cart-index"),10),o=n[r],a=e.products[o.productSKU];cityssm.confirmModal('Remove "'+a.productName+'"?',"Are you sure you want to remove this item from your cart?","Yes, Remove It","warning",()=>{exports.cart.remove(r),c()})},i=(r,o)=>{const n=e.products[r.productSKU];n||(exports.cart.clear(),location.reload());const i=document.createElement("li");if(i.className="card-content",i.innerHTML='<div class="columns"><div class="column is-narrow has-text-right"><button class="button is-inverted is-danger has-tooltip-arrow has-tooltip-right has-tooltip-hidden-mobile" data-cart-index="'+o.toString()+'" data-tooltip="Remove from Cart" type="button"><i class="fas fa-times" aria-hidden="true"></i><span class="is-hidden-tablet ml-2">Remove from Cart</span></button></div><div class="column"><strong class="container--productName"></strong><br /><div class="is-size-7 container--formFields"></div></div><div class="column is-narrow column--quantity has-text-right"></div><div class="column is-narrow column--price has-text-weight-bold has-text-right"></div></div>',i.getElementsByTagName("button")[0].addEventListener("click",s),i.getElementsByClassName("container--productName")[0].innerText=n.productName,n.formFieldsToSave&&n.formFieldsToSave.length>0){const e=i.getElementsByClassName("container--formFields")[0];for(const t of n.formFieldsToSave)if(r[t.formFieldName]){e.insertAdjacentHTML("beforeend","<strong>"+t.fieldName+":</strong> ");const o=document.createElement("span");o.innerText=r[t.formFieldName],e.appendChild(o),e.insertAdjacentHTML("beforeend","<br />")}}i.getElementsByClassName("column--quantity")[0].innerText=r.quantity+" Ã— $"+n.price.toFixed(2);const c=n.price*parseInt(r.quantity,10);if(i.getElementsByClassName("column--price")[0].innerText="$"+c.toFixed(2),t.appendChild(i),a.itemTotal+=c,n.feeTotals&&Object.keys(n.feeTotals).length>0)for(const e of Object.keys(n.feeTotals))a.feeTotals[e]=(a.feeTotals[e]||0)+n.feeTotals[e]},c=()=>{cityssm.clearElement(t),cityssm.clearElement(r),a={itemTotal:0,feeTotals:{}},0===(n=exports.cart.get()).length?(t.classList.add("is-hidden"),o.classList.add("is-hidden"),document.getElementById("button--clearCart").classList.add("is-hidden"),t.insertAdjacentHTML("beforebegin",'<div class="message is-info"><div class="message-body has-text-centered"><p class="has-text-weight-bold">The cart is empty.</p><p><a href="/products">View Available Products</a></p></div></div>')):(n.forEach(i),t.classList.remove("is-hidden"),o.classList.remove("is-hidden"));let s=a.itemTotal;if(Object.keys(a.feeTotals).length>0){r.insertAdjacentHTML("beforeend",'<div class="has-text-weight-bold">Subtotal: $'+a.itemTotal.toFixed(2)+"</div>");for(const t of Object.keys(a.feeTotals))r.insertAdjacentHTML("beforeend","<div>"+e.fees[t].feeName+": $"+a.feeTotals[t].toFixed(2)+"</div>"),s+=a.feeTotals[t]}r.insertAdjacentHTML("beforeend",'<div class="is-size-4 has-text-weight-bold">Total: $'+s.toFixed(2)+"</div>")};let d=!1;o.addEventListener("submit",e=>{if(e.preventDefault(),d)return;d=!0;const t=formToObject(o);t.cartItems=exports.cart.get(),fetch("/checkout/doCreateOrder",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()})).then(e=>{e.success?(document.getElementById("toPayment_orderNumber").value=e.orderNumber,document.getElementById("toPayment_orderSecret").value=e.orderSecret,document.getElementById("form--toPayment").submit()):(cityssm.alertModal("Order Error","An error occurred while trying to create your order. Please try again.","OK","danger"),d=!1)}).catch(e=>{cityssm.alertModal("Order Error","An error occurred while trying to create your order. Please try again.","OK","danger"),d=!1})}),(()=>{const t=(()=>{const e=new Set,t=exports.cart.get();for(const r of t)e.add(r.productSKU);return Array.from(e)})().join(",");""!==t?fetch("/checkout/doGetProductDetails",{method:"POST",body:new URLSearchParams({productSKUs:t})}).then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()})).then(t=>{e=t,c()}).catch(()=>{}):c()})(),document.getElementById("button--clearCart").addEventListener("click",()=>{cityssm.confirmModal("Clear Cart?","Are you sure you want to remove all items from your cart?","Yes, Clear the Cart","warning",()=>{exports.cart.clear(),c()})}),window.setTimeout(()=>{exports.cart.refresh()},3e5)})();