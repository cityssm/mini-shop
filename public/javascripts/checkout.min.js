"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(n,r){function s(e){try{c(a.next(e))}catch(e){r(e)}}function i(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,i)}c((a=a.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e={};const t=document.getElementById("card--cart"),o=document.getElementById("container--cartTotal"),a=document.getElementById("form--shipping");let n={itemTotal:0,feeTotals:{}};const r=t=>{t.preventDefault();const o=parseInt(t.currentTarget.getAttribute("data-cart-index")),a=exports.cart.get()[o],n=e.products[a.productSKU];cityssm.confirmModal('Remove "'+n.productName+'"?',"Are you sure you want to remove this item from your cart?","Yes, Remove It","warning",()=>{exports.cart.remove(o),i()})},s=(o,a)=>{const s=e.products[o.productSKU];s||(exports.cart.clear(),location.reload());const i=document.createElement("li");if(i.className="card-content",i.innerHTML='<div class="columns"><div class="column is-narrow has-text-right"><button class="button is-inverted is-danger has-tooltip-arrow has-tooltip-right has-tooltip-hidden-mobile" data-cart-index="'+a.toString()+'" data-tooltip="Remove from Cart" type="button"><i class="fas fa-times" aria-hidden="true"></i><span class="is-hidden-tablet ml-2">Remove from Cart</span></button></div><div class="column"><strong class="container--productName"></strong><br /><div class="is-size-7 container--formFields"></div></div><div class="column is-narrow column--quantity has-text-right"></div><div class="column is-narrow column--price has-text-weight-bold has-text-right"></div></div>',i.getElementsByTagName("button")[0].addEventListener("click",r),i.getElementsByClassName("container--productName")[0].innerText=s.productName,s.formFieldsToSave&&s.formFieldsToSave.length>0){const e=i.getElementsByClassName("container--formFields")[0];for(const t of s.formFieldsToSave)if(o[t.formFieldName]){e.insertAdjacentHTML("beforeend","<strong>"+t.fieldName+":</strong> ");const a=document.createElement("span");a.innerText=o[t.formFieldName],e.appendChild(a),e.insertAdjacentHTML("beforeend","<br />")}}i.getElementsByClassName("column--quantity")[0].innerText=o.quantity+" Ã— $"+s.price.toFixed(2);const c=s.price*parseInt(o.quantity);if(i.getElementsByClassName("column--price")[0].innerText="$"+c.toFixed(2),t.appendChild(i),n.itemTotal+=c,s.feeTotals&&Object.keys(s.feeTotals).length>0)for(const e of Object.keys(s.feeTotals))n.feeTotals[e]=(n.feeTotals[e]||0)+s.feeTotals[e]},i=()=>{cityssm.clearElement(t),cityssm.clearElement(o),n={itemTotal:0,feeTotals:{}};const r=exports.cart.get();0===r.length?(t.classList.add("is-hidden"),a.classList.add("is-hidden"),t.insertAdjacentHTML("beforebegin",'<div class="message is-info"><div class="message-body has-text-centered"><p class="has-text-weight-bold">The cart is empty.</p><p><a href="/products">View Available Products</a></p></div></div>')):(r.forEach(s),t.classList.remove("is-hidden"),a.classList.remove("is-hidden"));let i=n.itemTotal;if(Object.keys(n.feeTotals).length>0){o.insertAdjacentHTML("beforeend",'<div class="has-text-weight-bold">Subtotal: $'+n.itemTotal.toFixed(2)+"</div>");for(const t of Object.keys(n.feeTotals))o.insertAdjacentHTML("beforeend","<div>"+e.fees[t].feeName+": $"+n.feeTotals[t].toFixed(2)+"</div>"),i+=n.feeTotals[t]}o.insertAdjacentHTML("beforeend",'<div class="is-size-4 has-text-weight-bold">Total: $'+i.toFixed(2)+"</div>")};a.addEventListener("submit",e=>{e.preventDefault();const t=formToObject(a);t.cartItems=exports.cart.get(),fetch("/checkout/doCreateOrder",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()})).then(e=>{document.getElementById("toPayment_orderNumber").value=e.orderNumber,document.getElementById("toPayment_orderSecret").value=e.orderSecret,document.getElementById("form--toPayment").submit()}).catch(()=>{})}),(()=>{const t=(()=>{const e=new Set,t=exports.cart.get();for(const o of t)e.add(o.productSKU);return Array.from(e)})().join(",");""!==t?fetch("/checkout/doGetProductDetails",{method:"POST",body:new URLSearchParams({productSKUs:t})}).then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()})).then(t=>{e=t,i()}).catch(()=>{}):i()})(),document.getElementById("button--clearCart").addEventListener("click",()=>{cityssm.confirmModal("Clear Cart?","Are you sure you want to remove all items from your cart?","Yes, Clear the Cart","warning",()=>{exports.cart.clear(),i()})}),window.setTimeout(()=>{exports.cart.refresh()},3e5)})();